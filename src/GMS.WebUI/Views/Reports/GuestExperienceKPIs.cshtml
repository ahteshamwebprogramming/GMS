@model GMS.Infrastructure.ViewModels.Dashboard.DashboardViewModel

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Guest Experience KPIs";
}
<div class="admin_wrapper">
    @* @Html.Partial("_home/_leftNavigationHome") *@
    @Html.Partial("_reports/_leftNavigationReports")


    <div class="right_container content">

        <div class="">
            <div class="therapiesList_table_list">
                <div class="title_area">
                    <h2>Daily Sales and Payment Collection Report</h2>
                </div>
            </div>
        </div>

        @Html.Partial("_reports/_filterYearMonth")

        <div class="">

            <div class="table-container">
                <button class="scroll-btn scroll-left hidden" id="scrollLeft">&#9664;</button>
                <div class="scrollable-content" id="scrollContainer">
                    <table class="table table-bordered text-center" style="margin-bottom:20px;">
                        <thead class="table-dark">                            
                            <tr>
                                <th class="header-dark"> </th>
                                <th class="header-dark">1</th>
                                <th class="header-dark">2</th>
                                <th class="header-dark">3</th>
                                <th class="header-dark">4</th>
                                <th class="header-dark">5</th>
                                <th class="header-dark">6</th>
                                <th class="header-dark">7</th>
                                <th class="header-dark">8</th>
                                <th class="header-dark">9</th>
                                <th class="header-dark">10</th>
                                <th class="header-dark">11</th>
                                <th class="header-dark">12</th>
                                <th class="header-dark">13</th>
                                <th class="header-dark">14</th>
                                <th class="header-dark">15</th>
                                <th class="header-dark">16</th>
                                <th class="header-dark">17</th>
                                <th class="header-dark">18</th>
                                <th class="header-dark">19</th>
                                <th class="header-dark">20</th>
                                <th class="header-dark">21</th>
                                <th class="header-dark">22</th>
                                <th class="header-dark">23</th>
                                <th class="header-dark">24</th>
                                <th class="header-dark">25</th>
                                <th class="header-dark">26</th>
                                <th class="header-dark">27</th>
                                <th class="header-dark">28</th>
                                <th class="header-dark">29</th>
                                <th class="header-dark">30</th>
                                <th class="header-dark">31</th>
                            </tr>
                            <tr>
                                <th class="header-dark"> </th>
                                <th class="header-grey">We</th>
                                <th class="header-grey">Th</th>
                                <th class="header-grey">Fr</th>
                                <th class="header-grey">Sa</th>
                                <th class="header-grey">Su</th>
                                <th class="header-grey">Mo</th>
                                <th class="header-grey">Tu</th>
                                <th class="header-grey">We</th>
                                <th class="header-grey">Th</th>
                                <th class="header-grey">Fr</th>
                                <th class="header-grey">Sa</th>
                                <th class="header-grey">Su</th>
                                <th class="header-grey">Mo</th>
                                <th class="header-grey">Tu</th>
                                <th class="header-grey">We</th>
                                <th class="header-grey">Th</th>
                                <th class="header-grey">Fr</th>
                                <th class="header-grey">Sa</th>
                                <th class="header-grey">Su</th>
                                <th class="header-grey">Mo</th>
                                <th class="header-grey">Tu</th>
                                <th class="header-grey">We</th>
                                <th class="header-grey">Th</th>
                                <th class="header-grey">Fr</th>
                                <th class="header-grey">Sa</th>
                                <th class="header-grey">Su</th>
                                <th class="header-grey">Mo</th>
                                <th class="header-grey">Tu</th>
                                <th class="header-grey">We</th>
                                <th class="header-grey">Th</th>
                                <th class="header-grey">Fr</th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                if (Model != null && Model.RoomOccupancyDataList != null)
                                {
                                    var roomTypesIds = Model.RoomOccupancyDataList.GroupBy(x => x.ID).ToList();
                                    var dates = Model.RoomOccupancyDataList.GroupBy(x => x.TheDate).ToList();
                                    <tr>
                                        <td style="min-height: 34px;background:#8ACCD5"></td>
                                        <td colspan="@dates.Count" style="background:#8ACCD5"> <strong>Guest Satisfaction Report</strong></td>
                                    </tr>
                                    <tr>
                                        <td class="premium-room">Net Promoter Score (NPS)</td>
                                        @{
                                            foreach (var date in dates)
                                            {
                                                <td>#####</td>
                                            }
                                        }
                                    </tr>
                                    <tr>
                                        <td class="premium-room">Guest Satisfaction Score</td>
                                        @{
                                            foreach (var date in dates)
                                            {
                                                <td>#####</td>
                                            }
                                        }
                                    </tr>
                                    <tr>
                                        <td class="premium-room">Average Review Rating</td>
                                        @{
                                            foreach (var date in dates)
                                            {
                                                <td>#####</td>
                                            }
                                        }
                                    </tr>
                                    <tr>
                                        <td class="premium-room">Repeat Guest Ratio</td>
                                        @{
                                            foreach (var date in dates)
                                            {
                                                <td>#####</td>
                                            }
                                        }
                                    </tr>
                                    <tr>
                                        <td class="premium-room">Service Response Time</td>
                                        @{
                                            foreach (var date in dates)
                                            {
                                                <td>#####</td>
                                            }
                                        }
                                    </tr>

                                }
                            }
                        </tbody>
                    </table>

                </div>
                <button class="scroll-btn scroll-right" id="scrollRight">&#9654;</button>
            </div>


        </div>


        <div class="card p-4" style="margin-bottom:10px;">
            <h4>NPS</h4>
            <!-- You can place a chart here later -->
            <div id="NPSChart">
            </div>
        </div>
        <div class="card p-4" style="margin-bottom:10px;">
            <h4>Customer Satisfaction</h4>
            <!-- You can place a chart here later -->
            <div id="CustomerSatisfactionChart">
            </div>
        </div>
        <div class="card p-4" style="margin-bottom:130px;">
            <h4>Repeat Guest Ratio</h4>
            <!-- You can place a chart here later -->
            <div id="RepeatGuestRatioChart">
            </div>
        </div>


    </div>

    @Html.Partial("_bottomNavigation1")
</div>







@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <script src="~/customjs/validation.js"></script>
    <script src="~/customjs/reports/filteryearmonth.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
                     $("#inputmonthyearselector").datetimepicker({
            format: 'M-Y',            // month-year format (e.g., 05-2025)
            timepicker: false,        // no time picker
            datepicker: true,         // enable datepicker
            viewMode: 'months',       // start with month view (some plugins use this)
            minView: 'months',        // limit selection to month level
        });
        NPSChart();
        CustomerSatisfactionChart();
        RepeatGuestRatioChart();
        });

        const scrollContainer = document.getElementById("scrollContainer");
        const scrollLeft = document.getElementById("scrollLeft");
        const scrollRight = document.getElementById("scrollRight");
        const scrollStep = 200; // Pixels to scroll on each click

        function updateButtons() {
            scrollLeft.classList.toggle("hidden", scrollContainer.scrollLeft <= 0);
            scrollRight.classList.toggle("hidden", scrollContainer.scrollLeft + scrollContainer.clientWidth >= scrollContainer.scrollWidth);
        }

        scrollLeft.addEventListener("click", () => {
            scrollContainer.scrollBy({ left: -scrollStep, behavior: "smooth" });
        });

        scrollRight.addEventListener("click", () => {
            scrollContainer.scrollBy({ left: scrollStep, behavior: "smooth" });
        });

        scrollContainer.addEventListener("scroll", updateButtons);
        window.addEventListener("resize", updateButtons);

        updateButtons(); // Ensure correct button visibility on load


        function NPSChart(){
             var options = {
          series: [{
          name: 'Promoters',
          data: [0.4, 0.65, 0.76, 0.88, 1.5, 2.1, 2.9, 3.8, 3.9, 4.2, 4, 4.3, 4.1, 4.2, 4.5,
            3.9, 3.5, 3
          ]
        },
        {
          name: 'Detractors',
          data: [-0.8, -1.05, -1.06, -1.18, -1.4, -2.2, -2.85, -3.7, -3.96, -4.22, -4.3, -4.4,
            -4.1, -4, -4.1, -3.4, -3.1, -2.8
          ]
        }
        ],
          chart: {
          type: 'bar',
          height: 440,
          stacked: true
        },
        colors: ['#008FFB', '#FF4560'],
        plotOptions: {
          bar: {
            borderRadius: 5,
            borderRadiusApplication: 'end', // 'around', 'end'
            borderRadiusWhenStacked: 'all', // 'all', 'last'
            horizontal: true,
            barHeight: '80%',
          },
        },
        dataLabels: {
          enabled: false
        },
        stroke: {
          width: 1,
          colors: ["#fff"]
        },

        grid: {
          xaxis: {
            lines: {
              show: false
            }
          }
        },
        yaxis: {
          stepSize: 1
        },
        tooltip: {
          shared: false,
          x: {
            formatter: function (val) {
              return val
            }
          },
          y: {
            formatter: function (val) {
              return Math.abs(val) + "%"
            }
          }
        },
        // title: {
        //   text: 'Mauritius population pyramid 2011'
        // },
        xaxis: {
          categories: ['85+', '80-84', '75-79', '70-74', '65-69', '60-64', '55-59', '50-54',
            '45-49', '40-44', '35-39', '30-34', '25-29', '20-24', '15-19', '10-14', '5-9',
            '0-4'
          ],
          title: {
            text: 'Percent'
          },
          labels: {
            formatter: function (val) {
              return Math.abs(Math.round(val)) + "%"
            }
          }
        },
        };

        var chart = new ApexCharts(document.querySelector("#NPSChart"), options);
        chart.render();
        }

        function CustomerSatisfactionChart(){
             var options = {
          series: [{
          name: 'Inflation',
          data: [2.3, 3.1, 4.0, 10.1, 4.0, 3.6, 3.2, 2.3, 1.4, 0.8, 0.5, 0.2]
        }],
          chart: {
          height: 350,
          type: 'bar',
        },
        plotOptions: {
          bar: {
            borderRadius: 10,
            dataLabels: {
              position: 'top', // top, center, bottom
            },
          }
        },
        dataLabels: {
          enabled: true,
          formatter: function (val) {
            return val + "%";
          },
          offsetY: -20,
          style: {
            fontSize: '12px',
            colors: ["#304758"]
          }
        },

        xaxis: {
          categories: ["1 Apr 2025", "2 Apr 2025", "3 Apr 2025", "4 Apr 2025", "5 Apr 2025", "6 Apr 2025", "7 Apr 2025", "8 Apr 2025", "9 Apr 2025", "10 Apr 2025", "11 Apr 2025", "12 Apr 2025"],
          position: 'top',
          axisBorder: {
            show: false
          },
          axisTicks: {
            show: false
          },
          crosshairs: {
            fill: {
              type: 'gradient',
              gradient: {
                colorFrom: '#D8E3F0',
                colorTo: '#BED1E6',
                stops: [0, 100],
                opacityFrom: 0.4,
                opacityTo: 0.5,
              }
            }
          },
          tooltip: {
            enabled: true,
          }
        },
        yaxis: {
          axisBorder: {
            show: false
          },
          axisTicks: {
            show: false,
          },
          labels: {
            show: false,
            formatter: function (val) {
              return val + "%";
            }
          }

        },
        title: {
          //text: 'Monthly Inflation in Argentina, 2002',
          floating: true,
          offsetY: 330,
          align: 'center',
          style: {
            color: '#444'
          }
        }
        };

        var chart = new ApexCharts(document.querySelector("#CustomerSatisfactionChart"), options);
        chart.render();
        }
        function RepeatGuestRatioChart(){
              var options = {
          series: [
          {
            name: 'Q1 Budget',
            group: 'budget',
            data: [44000, 55000, 41000, 67000, 22000, 43000]
          },
          {
            name: 'Q2 Budget',
            group: 'budget',
            data: [13000, 36000, 20000, 8000, 13000, 27000]
          }
        ],
          chart: {
          type: 'bar',
          height: 350,
          stacked: true,
        },
        stroke: {
          width: 1,
          colors: ['#fff']
        },
        dataLabels: {
          formatter: (val) => {
            return val / 1000 + 'K'
          }
        },
        plotOptions: {
          bar: {
            horizontal: false
          }
        },
        xaxis: {
          categories: [
            '1 Apr 2025',
            '2 Apr 2025',
            '3 Apr 2025',
            '4 Apr 2025',
            '5 Apr 2025',
            '6 Apr 2025'
          ]
        },
        fill: {
          opacity: 1
        },
        colors: ['#80c7fd', '#008FFB', '#80f1cb', '#00E396'],
        yaxis: {
          labels: {
            formatter: (val) => {
              return val / 1000 + 'K'
            }
          }
        },
        legend: {
          position: 'top',
          horizontalAlign: 'left'
        }
        };

        var chart = new ApexCharts(document.querySelector("#RepeatGuestRatioChart"), options);
        chart.render();
        }


    </script>
}
