@using System.Globalization
@model GMS.Infrastructure.ViewModels.Guests.GuestsListViewModel




<div class="guest_list">
    @{
        if (Model != null && Model.MemberDetailsWithChildren != null)
        {
            if (Model.MemberDetailsWithChildren.Count > 0)
            {
                foreach (var item in Model.MemberDetailsWithChildren)
                {
                    <div class="guest_info @(item.PaxCompleted == false ? "guest_info_attention" : "")">
                        <div class="guest_header">

                            <span class="user_icon @(item.PaxCompleted == false ? "user_icon_attention" : "")"><strong>@item.RoomNumber</strong> </span>
                            <div class="dropdown">
                                <button class="three-dots dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-three-dots-vertical"></i>
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                    @{
                                        // <li><a class="dropdown-item" href="javascript:void(0)" onclick="AddGuestsPartialView('@item.GroupId')"><i class="bi bi-pencil-fill"></i> Edit</a></li>
                                        // <li><a class="dropdown-item" href="javascript:void(0)" onclick="ChangeInOutDatePartialView(@item.Id)"><i class="bi bi-file-earmark-plus-fill"></i> Change In/Out Dates</a></li>

                                        if (item.IsSettled == false)
                                        {
                                            <li><a class="dropdown-item" href="javascript:void(0)" onclick="AddGuestsPartialView('@item.GroupId')"><i class="bi bi-pencil-fill"></i> Edit</a></li>
                                        }
                                        <li><a class="dropdown-item" href="javascript:void(0)" onclick="ChangeReservationDetailsPartialView('@item.Id')"><i class="bi bi-pencil-fill"></i> Modify Stay </a></li>
                                        <li><a class="dropdown-item" href="/Guests/ReviewMemberDetails/@item.Id" target="_blank"><i class="bi bi-eye-fill"></i> Review</a></li>
                                        if (item.IsSettled == false)
                                        {
                                            <li><a class="dropdown-item" href="javascript:void(0)" onclick="AddRoomPartialView(@item.Id)"><i class="bi bi-file-earmark-plus-fill"></i> Change Room</a></li>
                                            <li><a class="dropdown-item" href="javascript:void(0)" onclick="ChangeInOutDatePartialView(@item.Id)"><i class="bi bi-file-earmark-plus-fill"></i> Change In/Out Dates</a></li>
                                            <li><a class="dropdown-item" href="javascript:void(0)" onclick="AddServicesPartialView(@item.Id)"><i class="bi bi-file-earmark-plus-fill"></i> Add Services</a></li>
                                            <li><a class="dropdown-item" href="/Guests/GuestSchedule/@item.Id"><i class="bi bi-clock-fill"></i> Schedules</a></li>
                                        }
                                        <li><a class="dropdown-item" href="/Guests/PrintMemberDetails/@item.Id" target="_blank"><i class="bi bi-printer-fill"></i> Print</a></li>
                                        <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#exampleModal2"><i class="bi bi-file-earmark-arrow-up-fill"></i> Upload</a></li>
                                        <li><a class="dropdown-item" href="javascript:void(0)" onclick="BillingPartialView('@item.Id')"><i class="bi bi-cash-stack"></i> Billing</a></li>
                                        @*<li><a class="dropdown-item" href="javascript:void(0)" onclick="SettlementPartialView('@item.Id')"><i class="bi bi-pencil-fill"></i> Settelment</a></li>*@
                                        @*<li><a class="dropdown-item" onclick="OpenFeedbackView(@item.Id)" href="/ReviewAndFeedbacks/Feedback/@item.Id" target="_blank"><i class="bi bi-chat-dots"></i> Feedback</a></li>*@
                                        <li><a class="dropdown-item" onclick="OpenFeedbackView(@item.Id)"><i class="bi bi-chat-dots"></i> Feedback</a></li>
                                    }
                                </ul>
                            </div>

                        </div>
                        <a href="#">

                            <ul class="usert_info">
                                <li><i class="bi bi-person-vcard"></i> <span>@item.UHID</span></li>
                                <li><i class="bi bi-person"></i> <span>@item.CustomerName</span></li>
                                <li><i class="bi bi-ticket-perforated"></i> <span>@(string.IsNullOrWhiteSpace(item.GroupId) ? "-" : item.GroupId)</span></li>
                                <li><i class="bi bi-phone"></i> <span>@item.MobileNo</span></li>
                                <li><i class="bi bi-calendar"></i> <span> @item.DateOfArrival?.ToString("dd-MMM-yy") to @item.DateOfDepartment?.ToString("dd-MMM-yy")</span></li>
                                <li><i class="fas fa-bed"></i> <span>@(string.IsNullOrWhiteSpace(item.RoomTypeName) ? "-" : item.RoomTypeName)</span></li>
                                <li><i class="bi bi-clock"></i> <span>@item.Category</span></li>

                                @{
                                    string memberAge = "-";
                                    if (!String.IsNullOrEmpty(item.Dob))
                                    {
                                        DateTime today = DateTime.Today;
                                        DateTime dob = DateTime.ParseExact(item.Dob, "dd-MM-yyyy", CultureInfo.InvariantCulture);
                                        int age = today.Year - dob.Year;
                                        if (dob.Date > today.AddYears(-age)) age--;
                                        memberAge = age.ToString();
                                    }
                                }
                                <li><i class="bi bi-gender-ambiguous"></i> <span>@(item.GenderName == null ? "-" : item.GenderName) / @(memberAge)</span></li>
                                @*<li><i class="bi bi-person-fill"></i> <span>@(memberAge)</span></li>*@

                            </ul>
                        </a>
                        <div class="guest_info_bottom_button">
                            @{
                                bool isCancelledReservation = item?.Cancelled == true;
                                bool canCheckIn = !isCancelledReservation && item.CheckInStatus == 2;
                                bool canNoShow = !isCancelledReservation && item.CheckInStatus == 2;
                                bool canReview = isCancelledReservation || item.CheckInStatus == 4;
                                bool canCancel = !isCancelledReservation && (item.CheckInStatus == 1 || item.CheckInStatus == 2);
                                bool canCheckOut = !isCancelledReservation && item.CheckInStatus == 3;
                            }

                            <div class="button-strip" role="group" aria-label="Guest action buttons">
                                <button class="btn-icon @(canCheckIn ? string.Empty : "disabled")" type="button" title="Check-in" @(canCheckIn ? string.Empty : "disabled") onclick="OpenCheckInListModalPartialView(@item.Id,'@item.UniqueNo','@item?.CustomerName?.Replace("'", "\\'")','@item.DateOfArrival?.ToString("yyyy-MM-dd HH:mm")')">
                                    <i class="bi bi-door-open"></i>
                                </button>
                                <button class="btn-icon @(canNoShow ? string.Empty : "disabled")" type="button" title="No Show" @(canNoShow ? string.Empty : "disabled") onclick="GuestNoShow(@item.Id)">
                                    <i class="bi bi-ban"></i>
                                </button>
                                <button class="btn-icon @(canReview ? string.Empty : "disabled")" type="button" title="Review" @(canReview ? string.Empty : "disabled") onclick="javascript:void(0)">
                                    <i class="bi bi-file-check"></i>
                                </button>
                                <button class="btn-icon @(canCancel ? string.Empty : "disabled")" type="button" title="Cancel" @(canCancel ? string.Empty : "disabled") onclick="CancelGuestReservation(@item.Id)">
                                    <i class="bi bi-eye-slash"></i>
                                </button>
                                <button class="btn-icon @(canCheckOut ? string.Empty : "disabled")" type="button" title="Check-out" @(canCheckOut ? string.Empty : "disabled") onclick="OpenCheckOutListModalPartialView(@item.Id,'@item.UniqueNo','@item?.CustomerName?.Replace("'", "\\'")','@item.DateOfDepartment?.ToString("yyyy-MM-dd HH:mm")')">
                                    <i class="bi bi-door-closed"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                }
            }
        }
    }

</div>
@{
    if (Model?.GuestsWithChildren?.Count == 0)
    {
        <div class="no_record">
            <div class="noc">
                <span><img src="~/assets/img/no-record.png"></span>
                <h3>No Guests Found!</h3>
            </div>
        </div>
    }
    else
    {
        <div class="pagination2">
            @{
                if (Model != null && Model.GuestsGridViewParameters != null)
                {
                    int PageIndex = Model.GuestsGridViewParameters.PageNumber ?? default(int);
                    int TotalPages = Model.GuestsGridViewParameters.TotalPages ?? default(int);

                    <nav aria-label="Page navigation example">
                        <ul class="pagination">
                            <li class="page-item"><a class="page-link" href="javascript:void(0)" onclick="GuestsListPartialView(@(PageIndex > 1 ? PageIndex - 1 : 1))">Previous</a></li>

                            @if (PageIndex > 3)
                            {
                                <li class="page-item"><a class="page-link" href="javascript:void(0)" onclick="GuestsListPartialView(1)">1</a></li>
                                <li class="page-item disabled"><a class="page-link" href="javascript:void(0)">...</a></li>
                            }
                            @for (var i = Math.Max(1, PageIndex - 1); i <= Math.Min(PageIndex + 1, TotalPages); i++)
                            {
                                <li class="page-item @(i == PageIndex ? "active" : "")"><a class="page-link" href="javascript:void(0)" onclick="GuestsListPartialView(@i)">@i</a></li>
                            }
                            @if (PageIndex < TotalPages - 2)
                            {
                                <li class="page-item disabled"><span class="page-link">...</span></li>
                                <li class="page-item"><a class="page-link" href="javascript:void(0)" onclick="GuestsListPartialView(@TotalPages)">@TotalPages</a></li>
                            }
                            <li class="page-item"><a class="page-link" href="javascript:void(0)" onclick="GuestsListPartialView(@(PageIndex<TotalPages?  PageIndex + 1 : TotalPages))">Next</a></li>


                            @*<li class="page-item last">
            <a class="page-link" href="javascript:void(0)" onclick="ProjectListPartialView(@TotalPages)">
            <i class="fa-solid fa-angles-right"></i>
            </a>
            </li>*@

                        </ul>
                    </nav>

                }
            }
        </div>
    }
}